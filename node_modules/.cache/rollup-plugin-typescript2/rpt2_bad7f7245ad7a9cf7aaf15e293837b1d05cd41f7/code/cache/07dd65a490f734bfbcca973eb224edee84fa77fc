{"code":"import * as React from \"react\";\r\nimport useLocalStorage from \"./useLocalStorage\";\r\nexport const initialState = {\r\n    items: [],\r\n    isEmpty: true,\r\n    totalItems: 0,\r\n    totalUniqueItems: 0,\r\n    //cartTotal: 0,\r\n    metadata: {},\r\n};\r\nconst WatchlistContext = React.createContext(initialState);\r\nexport const createWatchlistIdentifier = (len = 12) => [...Array(len)].map(() => (~~(Math.random() * 36)).toString(36)).join(\"\");\r\nexport const useWatchlist = () => {\r\n    const context = React.useContext(WatchlistContext);\r\n    if (!context)\r\n        throw new Error(\"Expected to be wrapped in a WatchlistProvider\");\r\n    return context;\r\n};\r\nfunction reducer(state, action) {\r\n    switch (action.type) {\r\n        case \"SET_ITEMS\":\r\n            return generateWatchlistState(state, action.payload);\r\n        case \"ADD_ITEM\": {\r\n            const items = [...state.items, action.payload];\r\n            return generateWatchlistState(state, items);\r\n        }\r\n        case \"UPDATE_ITEM\": {\r\n            const items = state.items.map((item) => {\r\n                if (item.id !== action.id)\r\n                    return item;\r\n                return {\r\n                    ...item,\r\n                    ...action.payload,\r\n                };\r\n            });\r\n            return generateWatchlistState(state, items);\r\n        }\r\n        case \"REMOVE_ITEM\": {\r\n            const items = state.items.filter((i) => i.id !== action.id);\r\n            return generateWatchlistState(state, items);\r\n        }\r\n        case \"EMPTY_WATCHLIST\":\r\n            return initialState;\r\n        case \"CLEAR_WATCHLIST_META\":\r\n            return {\r\n                ...state,\r\n                metadata: {},\r\n            };\r\n        case \"SET_WATCHLIST_META\":\r\n            return {\r\n                ...state,\r\n                metadata: {\r\n                    ...action.payload,\r\n                },\r\n            };\r\n        case \"UPDATE_WATCHLIST_META\":\r\n            return {\r\n                ...state,\r\n                metadata: {\r\n                    ...state.metadata,\r\n                    ...action.payload,\r\n                },\r\n            };\r\n        default:\r\n            throw new Error(\"No action specified\");\r\n    }\r\n}\r\nconst generateWatchlistState = (state = initialState, items) => {\r\n    const totalUniqueItems = calculateUniqueItems(items);\r\n    const isEmpty = totalUniqueItems === 0;\r\n    return {\r\n        ...initialState,\r\n        ...state,\r\n        items: calculateItemTotals(items),\r\n        totalItems: calculateTotalItems(items),\r\n        totalUniqueItems,\r\n        //cartTotal: calculateTotal(items),\r\n        isEmpty,\r\n    };\r\n};\r\nconst calculateItemTotals = (items) => items.map(item => ({\r\n    ...item,\r\n    itemTotal: item.price * item.quantity,\r\n}));\r\n//const calculateTotal = (items: Item[]) =>\r\n//items.reduce((total, item) => total + item.quantity! * item.price, 0);\r\nconst calculateTotalItems = (items) => items.reduce((sum, item) => sum + item.quantity, 0);\r\nconst calculateUniqueItems = (items) => items.length;\r\nexport const WatchlistProvider = ({ children, id: watchlistId, defaultItems = [], onSetItems, onItemAdd, onItemUpdate, onItemRemove, storage = useLocalStorage, metadata, }) => {\r\n    const id = watchlistId ? watchlistId : createWatchlistIdentifier();\r\n    const [savedWatchlist, saveWatchlist] = storage(watchlistId ? `react-use-watchlist-${id}` : `react-use-watchlist`, JSON.stringify({\r\n        id,\r\n        ...initialState,\r\n        items: defaultItems,\r\n        metadata,\r\n    }));\r\n    const [state, dispatch] = React.useReducer(reducer, JSON.parse(savedWatchlist));\r\n    React.useEffect(() => {\r\n        saveWatchlist(JSON.stringify(state));\r\n    }, [state, saveWatchlist]);\r\n    const setItems = (items) => {\r\n        dispatch({\r\n            type: \"SET_ITEMS\",\r\n            payload: items.map(item => ({\r\n                ...item,\r\n                quantity: item.quantity || 1,\r\n            })),\r\n        });\r\n        onSetItems && onSetItems(items);\r\n    };\r\n    const addItem = (item, quantity = 1) => {\r\n        if (!item.id)\r\n            throw new Error(\"You must provide an `id` for items\");\r\n        //if (quantity <= 0) return;\r\n        const currentItem = state.items.find((i) => i.id === item.id);\r\n        //if (!currentItem && !item.hasOwnProperty(\"price\"))\r\n        //throw new Error(\"You must pass a `price` for new items\");\r\n        if (!currentItem) {\r\n            const payload = { ...item, quantity };\r\n            dispatch({ type: \"ADD_ITEM\", payload });\r\n            onItemAdd && onItemAdd(payload);\r\n            return;\r\n        }\r\n        const payload = { ...item, quantity: currentItem.quantity + quantity };\r\n        dispatch({\r\n            type: \"UPDATE_ITEM\",\r\n            id: item.id,\r\n            payload,\r\n        });\r\n        onItemUpdate && onItemUpdate(payload);\r\n    };\r\n    const updateItem = (id, payload) => {\r\n        if (!id || !payload) {\r\n            return;\r\n        }\r\n        dispatch({ type: \"UPDATE_ITEM\", id, payload });\r\n        onItemUpdate && onItemUpdate(payload);\r\n    };\r\n    const updateItemQuantity = (id, quantity) => {\r\n        if (quantity <= 0) {\r\n            onItemRemove && onItemRemove(id);\r\n            dispatch({ type: \"REMOVE_ITEM\", id });\r\n            return;\r\n        }\r\n        const currentItem = state.items.find((item) => item.id === id);\r\n        if (!currentItem)\r\n            throw new Error(\"No such item to update\");\r\n        const payload = { ...currentItem, quantity };\r\n        dispatch({\r\n            type: \"UPDATE_ITEM\",\r\n            id,\r\n            payload,\r\n        });\r\n        onItemUpdate && onItemUpdate(payload);\r\n    };\r\n    const removeItem = (id) => {\r\n        if (!id)\r\n            return;\r\n        dispatch({ type: \"REMOVE_ITEM\", id });\r\n        onItemRemove && onItemRemove(id);\r\n    };\r\n    const emptyWatchlist = () => dispatch({\r\n        type: \"EMPTY_WATCHLIST\",\r\n    });\r\n    const getItem = (id) => state.items.find((i) => i.id === id);\r\n    const inWatchlist = (id) => state.items.some((i) => i.id === id);\r\n    const clearWatchlistMetadata = () => {\r\n        dispatch({\r\n            type: \"CLEAR_WATCHLIST_META\",\r\n        });\r\n    };\r\n    const setWatchlistMetadata = (metadata) => {\r\n        if (!metadata)\r\n            return;\r\n        dispatch({\r\n            type: \"SET_WATCHLIST_META\",\r\n            payload: metadata,\r\n        });\r\n    };\r\n    const updateWatchlistMetadata = (metadata) => {\r\n        if (!metadata)\r\n            return;\r\n        dispatch({\r\n            type: \"UPDATE_WATCHLIST_META\",\r\n            payload: metadata,\r\n        });\r\n    };\r\n    return (React.createElement(WatchlistContext.Provider, { value: {\r\n            ...state,\r\n            getItem,\r\n            inWatchlist,\r\n            setItems,\r\n            addItem,\r\n            updateItem,\r\n            updateItemQuantity,\r\n            removeItem,\r\n            emptyWatchlist,\r\n            clearWatchlistMetadata,\r\n            setWatchlistMetadata,\r\n            updateWatchlistMetadata,\r\n        } }, children));\r\n};\r\n//# sourceMappingURL=index.js.map","references":["/Users/rdonmez/Documents/react-use-watchlist/node_modules/@types/react/index.d.ts","/Users/rdonmez/Documents/react-use-watchlist/src/useLocalStorage.ts"],"map":"{\"version\":3,\"file\":\"index.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../src/index.tsx\"],\"names\":[],\"mappings\":\"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\"}"}
